#!/bin/sh
set -e

. /usr/share/debconf/confmodule

# Ask for PAM mode (medium priority)
db_input medium open-bastion/pam-mode || true
db_go || true

db_get open-bastion/pam-mode
MODE="$RET"

# If a mode is selected, ask for LLNG parameters
if [ "$MODE" != "none" ]; then
    db_input high open-bastion/portal-url || true
    db_input medium open-bastion/client-id || true
    db_input high open-bastion/client-secret || true
    db_input low open-bastion/server-group || true
    db_input medium open-bastion/configure-sudo || true
    db_go || true

    # If sudo is enabled, ask for sudo server group
    db_get open-bastion/configure-sudo
    if [ "$RET" = "true" ]; then
        db_input low open-bastion/sudo-server-group || true
        db_go || true
    fi

    # Ask about auto-creating Unix accounts
    db_input medium open-bastion/create-user || true
    db_go || true
fi

exit 0
