# PAM LemonLDAP::NG Configuration File
# /etc/security/pam_llng.conf

# ==============================================================================
# Required Settings
# ==============================================================================

# LemonLDAP::NG portal URL
portal_url = https://auth.example.com

# OIDC client credentials (must match the RP configured in LLNG)
client_id = pam-access
client_secret = your-client-secret-here

# ==============================================================================
# Server Authentication
# ==============================================================================

# Path to file containing the server's access token
# This token is obtained during server enrollment via Device Authorization Grant
# The file should contain only the token and be readable only by root
server_token_file = /etc/security/pam_llng.token

# Server group name for authorization rules
# This must match a group defined in LLNG's pamAccessServerGroups
# Default: "default"
server_group = default

# ==============================================================================
# HTTP Settings
# ==============================================================================

# HTTP timeout in seconds
# Default: 10
timeout = 10

# Verify SSL certificates
# Set to false only for testing with self-signed certificates
# Default: true
verify_ssl = true

# Custom CA certificate path (optional)
# ca_cert = /etc/ssl/certs/my-ca.pem

# ==============================================================================
# Cache Settings
# ==============================================================================

# Enable token caching to reduce server load
# Default: true
cache_enabled = true

# Cache directory
# Default: /var/cache/pam_llng
cache_dir = /var/cache/pam_llng

# Cache TTL in seconds (time to live)
# Cached results expire after this time
# Default: 300 (5 minutes)
cache_ttl = 300

# ==============================================================================
# Operation Mode
# ==============================================================================

# Authorization-only mode
# When set to true, pam_sm_authenticate always succeeds (for SSH key auth)
# and only pam_sm_acct_mgmt performs authorization checks
# Default: false
authorize_only = false

# ==============================================================================
# Logging
# ==============================================================================

# Log level: error, warn, info, debug (or 0-3)
# Default: warn
log_level = warn

# ==============================================================================
# Bastion JWT Verification (for backend servers)
# ==============================================================================

# Require JWT from bastion for authentication
# When enabled, connections without a valid bastion JWT are rejected
# Default: false
# bastion_jwt_required = false

# Expected JWT issuer (LLNG portal URL)
# Must match the portal that signed the JWT
# bastion_jwt_issuer = https://auth.example.com

# JWKS endpoint URL for public key retrieval
# Default: {portal_url}/.well-known/jwks.json
# bastion_jwt_jwks_url = https://auth.example.com/.well-known/jwks.json

# Local cache file for JWKS (enables offline verification)
# Default: /var/cache/pam_llng/jwks.json
# bastion_jwt_jwks_cache = /var/cache/pam_llng/jwks.json

# JWKS cache TTL in seconds
# Default: 3600 (1 hour)
# bastion_jwt_cache_ttl = 3600

# Allowed clock skew in seconds for JWT expiration checks
# Default: 60
# bastion_jwt_clock_skew = 60

# Comma-separated list of allowed bastion IDs (client_id)
# Leave empty to allow all bastions
# bastion_jwt_allowed_bastions = bastion-prod-01,bastion-prod-02

# ==============================================================================
# JWT Replay Detection
# ==============================================================================

# Enable JTI-based replay detection
# Each JWT ID (jti) is cached and rejected if reused
# Default: true
# bastion_jwt_replay_detection = true

# Maximum number of JTI entries in cache
# Should be large enough to hold all expected JTIs during their TTL
# Default: 10000
# bastion_jwt_replay_cache_size = 10000

# Cleanup interval for expired JTI entries (seconds)
# Default: 60
# bastion_jwt_replay_cleanup_interval = 60
