.TH OB-ENROLL 8 "December 2025" "open-bastion 0.1.0" "System Administration"
.SH NAME
ob-enroll \- Enroll a server with LemonLDAP::NG for PAM authentication
.SH SYNOPSIS
.B ob-enroll
.RI [ OPTIONS ]
.SH DESCRIPTION
.B ob-enroll
uses the Device Authorization Grant (RFC 8628) to obtain a server token
that allows the PAM module to check user authorizations against a
LemonLDAP::NG server.
.PP
The enrollment process requires an administrator to authenticate on the
LemonLDAP::NG portal and approve the server registration using a displayed
verification code.
.SH OPTIONS
.TP
.BR \-p ", " \-\-portal " " \fIURL\fR
LemonLDAP::NG portal URL (required if not in config file).
.TP
.BR \-c ", " \-\-client\-id " " \fIID\fR
OIDC client ID. Default: pam-access
.TP
.BR \-s ", " \-\-client\-secret " " \fISECRET\fR
OIDC client secret (required if not in config file).
.TP
.BR \-g ", " \-\-server\-group " " \fIGROUP\fR
Server group name for authorization rules. Default: default
.TP
.BR \-t ", " \-\-token\-file " " \fIFILE\fR
Where to save the server token. Default: /etc/open-bastion/token
.TP
.BR \-C ", " \-\-config " " \fIFILE\fR
Read settings from config file. Default: /etc/open-bastion/openbastion.conf
.TP
.BR \-k ", " \-\-insecure
Skip SSL certificate verification.
.TP
.BR \-q ", " \-\-quiet
Quiet mode (less output).
.TP
.BR \-h ", " \-\-help
Show help message and exit.
.TP
.BR \-V ", " \-\-version
Show version and exit.
.SH EXAMPLES
.PP
Enroll using settings from config file:
.RS
.nf
sudo ob-enroll
.fi
.RE
.PP
Enroll with explicit parameters:
.RS
.nf
sudo ob-enroll \-p https://auth.example.com \-s mysecret
.fi
.RE
.PP
Enroll to a specific server group:
.RS
.nf
sudo ob-enroll \-g production
.fi
.RE
.SH FILES
.TP
.I /etc/open-bastion/openbastion.conf
Main configuration file for the PAM module.
.TP
.I /etc/open-bastion/token
Server token file created by this script.
.SH SECURITY
.PP
The enrollment process uses several security mechanisms:
.TP
.B PKCE (RFC 7636)
PKCE (Proof Key for Code Exchange) is automatically used to protect against
device_code interception attacks. A code_verifier is generated locally and
never transmitted until the token exchange, preventing attackers from using
an intercepted device_code.
.TP
.B client_secret_jwt (RFC 7523)
Client authentication uses JWT assertions signed with HMAC-SHA256.
The client_secret is never transmitted over the network; instead, it signs
a JWT with a unique jti claim to prevent replay attacks.
.TP
.B TLS
All communications with the LemonLDAP::NG server use HTTPS. Certificate
verification is enabled by default (use \-k to disable for testing only).
.SH EXIT STATUS
.TP
.B 0
Enrollment completed successfully.
.TP
.B 1
Enrollment failed (missing parameters, network error, authorization denied, etc.)
.SH SEE ALSO
.BR pam_openbastion (8),
.BR pam.d (5)
.PP
LemonLDAP::NG documentation: https://lemonldap-ng.org/
.SH AUTHOR
Xavier Guimard <xguimard@linagora.com>
.SH COPYRIGHT
Copyright (C) 2025 Linagora.
License: AGPL-3.0+
